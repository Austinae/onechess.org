include ./includes/head
	include ./includes/nav
	a(href="/create" role="button")#button Create Game
	span
	span
	p#gamestitle &nbsp;&nbsp;Available Games
	#gameButtons

	script(src="/socket.io/socket.io.js")
	script.
		var socket = io();
		var elements = [];

		function joinGame(){
			if(#{loggedIn}){
				socket.emit('joinGame', this.value);
			}else{
				alert("Please register or log in to join a game");
			}
		}

		socket.on('redirect', (destination)=>{
			window.location.href = destination;
		})
				
		socket.on('getGames', (data)=>{
			var i;
			var node= document.getElementById("gameButtons");
			node.querySelectorAll('*').forEach(n => n.remove());
			for(i=0; i<data.length;i++){
				var mydiv = document.getElementById("gameButtons");
				var button = document.createElement('button');
				button.classList.add('joinGame');
				button.value = data[i].gid;
				button.onclick = joinGame;
				switch(data[i].variant){
					case 1:
						button.innerText = "Type: Western Chess" + ", Time Control: "+data[i].time+" min + "+data[i].increment+" seconds";
						break;
					case 2:
						button.innerText = "Type: Xiangqi Chess" + ", Time Control: "+data[i].time+" min + "+data[i].increment+" seconds";
						break;
					case 3:
						button.innerText = "Type: Shogi Chess" + ", Time Control: "+data[i].time+" min + "+data[i].increment+" seconds";
						break;
					
				}
				//- button.innerText = "Game id: "+data[i].gid+ ", creator id: "+data[i].uid1+ ", variant: "+data[i].variant+ ", time: "+data[i].time;
				mydiv.appendChild(button);
			}
		})

		var timer = setInterval(getGames, 3000);
		socket.emit('getGames', 'please');
		function getGames() {
			socket.emit('getGames', 'please');
		}